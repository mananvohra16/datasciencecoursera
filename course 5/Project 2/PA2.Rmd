---
output:
  pdf_document: default
author: "Manan Vohra" 
date: "May 1, 2015"
---
----
title: "Peer-graded Assignment: Course Project 2"
output: html_document
----

```{r global.options, include = FALSE}
knitr::opts_chunk$set(
    cache       = TRUE,     # if TRUE knitr will cache the results to reuse in future knits
    fig.width   = 10,       # the width for plots created by code chunk
    fig.height  = 10,       # the height for plots created by code chunk
    fig.align   = 'center', # how to align graphics in the final doc. 'left', 'right', 'center'
    fig.path    = 'figs/',  # file path to the directory where knitr shall store the graphics files
    results     = 'asis',   # knitr will pass through results without reformatting them
    echo        = TRUE,     # in FALSE knitr will not display code in the code chunk above it's results
    message     = TRUE,     # if FALSE knitr will not display any messages generated by code
    strip.white = TRUE,     # if FALSE knitr will not remove white spaces at the beg or end of code chunk
    warning     = FALSE)    # if FALSE knitr will not display any warning messages in the final document
```

## Peer-graded Assignment: Course Project 2
By - Manan Vohra

December 7, 2020

## 1: Synopsis
The goal of this assignment is to exploration and analysis of the NOAA Storm Database to highlight the key insights regarding the severe weather events aon both the population and economy. The time line for this data is from 1950 till November 2011.


The following analysis investigates which types of severe weather events are most harmful on:
===
1. Health (injuries and fatalities) 
2. Property and crops (economic consequences)

Information on the Data: [DocumentNational Weather Serviceation](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf)

## 2: Data Processing

### 2.1: Data Loading
```{r}
library(dplyr)
library(ggplot2)
```

```{r cache=TRUE}
storm_data <- read.csv("StromData.csv.bz2")
colnames(storm_data)
```
### 2.2: Selecting Data

we will be selecting only those columns which we need for the analysis from the dataset. AS we are only interested in the correlation between the Nation - wide event to Health and Economic consequences, we will be using the following columns only:

  -EVTYPE: event type
  
  -FATALITIES: number of fatalities
  
  -INJURIES: number of injuries
  
  -PROPDMG: property damage (dollars)
  
  -PROPDMGEXP: magnitude of property damage (K = thousands, M = millions, B = billions)
  
  -CROPDMG: crop damage (dollars)
  
  -CROPDMGEXP: magnitude of crop damage (H = hundreds, K = thousands, M = millions, B = billions)


```{r}
storm_data <- storm_data[, c('EVTYPE', 'FATALITIES', 'INJURIES', 'PROPDMG', 'PROPDMGEXP', 'CROPDMG', 'CROPDMGEXP')]
head(storm_data)
summary(storm_data)
```

## 3: Data Analysis

### 3.1: Across the United States, which types of events (as indicated in the EVTYPE variable) are most harmful with respect to population health?

```{r}

Storm_data_q1 <- storm_data[, 1:3] %>%
                group_by(EVTYPE) %>%
                summarise_all(sum)
summary(Storm_data_q1)
```

```{r}
# Top 10 events by Fatalities
top_fatalities <- Storm_data_q1[order(Storm_data_q1$FATALITIES, decreasing = TRUE), ]
# Top 10 events by Injuries
top_injuries <- Storm_data_q1[order(Storm_data_q1$INJURIES, decreasing = TRUE), ]
# Top 10 events that causes both Fatalities and Injuries
Storm_data_q1$total <- rowSums(Storm_data_q1[, 2:3])
top_health <- Storm_data_q1[order(Storm_data_q1$total, decreasing = "TRUE"), ]

```

### 3.2: Across the United States, which types of events have the greatest economic consequences?

  Function for converting the 'EXP' column code to power of 10's
 
```{r}
value_conversion <- function(expType) {
  if (expType %in% c('h', 'H')) {
    return(2)
  } else if (expType %in% c('k', 'K')) {
    return(3)
  } else if (expType %in% c('m', 'M')) {
    return(6)
  } else if (expType %in% c('b', 'B')) {
    return(9)
  } else if (suppressWarnings(!is.na(as.numeric(expType)))) {
    #won't show: NAs introduced by coercion when given a non-number
    return(as.numeric(expType))
  } else {
    return(0)
  }
}
```

```{r}

Storm_data_q2 <- storm_data[, c(1, 4:7)] %>% rowwise() %>% mutate(prop_dmg = PROPDMG*10**value_conversion(PROPDMGEXP), crop_dmg = CROPDMG*10**value_conversion(CROPDMGEXP))

head(Storm_data_q2)

Storm_data_q2 <- Storm_data_q2[, c(1, 6, 7)] %>%
  group_by(EVTYPE) %>%
  summarise_all(sum)
summary(Storm_data_q2)

```

```{r}
# Top 10 events by Property dmage
top_prop_dmg <- Storm_data_q2[order(Storm_data_q2$prop_dmg, decreasing = TRUE), ]
# Top 10 events by Crop Damage
top_crop_dmg <- Storm_data_q2[order(Storm_data_q2$crop_dmg, decreasing = TRUE), ]
# Top 10 events that causes both Property and Crop Damage
Storm_data_q2$total <- rowSums(Storm_data_q2[, 2:3])
top_economic <- Storm_data_q2[order(Storm_data_q2$total, decreasing = "TRUE"), ]


```

### 4: Results

#### Find types of events that are most harmful with respect to population health
```{r fig.pos='h'}
options(repr.plot.width = 14, repr.plot.height = 8)
ggplot(data = top_health[1:10,], aes(x=reorder(EVTYPE, total), y=total))+
  geom_bar(stat = 'identity') +
  coord_flip() +
  xlab('Event Type') +
  ylab('Total health damage') +
  ggtitle('Top 10 weather events that causes health hazards')
```

#### Find types of events that have the greatest economic consequences
```{r fig.pos='h'}
ggplot(data = top_economic[1:10, ], aes(x = reorder(EVTYPE, total), y = total)) +
  #need to use reorder to prevent the categorical data from reordering
  geom_bar(stat = 'identity') +
  coord_flip() +
  scale_y_continuous(trans = 'log10') +
  xlab('Event type') +
  ylab('Total property and crop damages (log10)') +
  ggtitle('Top 10 weather events that causes economic hazards') +
  theme_classic()
  
```

